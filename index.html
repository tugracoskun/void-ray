<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rüya Bahçesi: Void Ray - Final Polish</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <audio id="bgMusic" loop>
        <source src="uploaded:Crater.mp3" type="audio/mpeg">
    </audio>
    
    <div id="toxic-overlay"></div>
    
    <!-- PAUSE / ESC MENU -->
    <div id="pause-overlay">
        <div class="pause-title">DURAKLATILDI</div>
        <button class="pause-btn" onclick="resumeGame()">DEVAM ET</button>
        <button class="pause-btn danger" onclick="quitToMain()">ANA MENÜ</button>
    </div>

    <!-- ANA MENÜ -->
    <div id="main-menu">
        <div class="title-main">VOID RAY</div>
        <svg class="void-symbol" viewBox="0 0 100 100" fill="none" stroke="rgba(56, 189, 248, 0.9)" stroke-width="2">
            <path d="M50 20 C 65 30, 90 45, 80 75 C 65 65, 55 85, 50 95 C 45 85, 35 65, 20 75 C 10 45, 35 30, 50 20 Z" fill="rgba(56, 189, 248, 0.1)"/>
            <circle cx="50" cy="40" r="3" fill="#e0f2fe" />
        </svg>
        
        <button id="btn-start" class="menu-btn">YAŞAM DÖNGÜSÜNÜ BAŞLAT</button>

        <div class="tips-container">
            <span id="tip-text" class="tip-text">Yankı'yla birleşmek için [F] tuşuna basın.</span>
        </div>

        <div class="controls-grid">
            <div class="key-row"><span class="key-cap">W</span><span class="key-cap">A</span><span class="key-cap">S</span><span class="key-cap">D</span> <span>Hareket</span></div>
            <div class="key-row"><span class="key-cap">E</span> <span>Nexus Etkileşim</span></div>
            <div class="key-row"><span class="key-cap">F</span> <span>Yankı Birleş</span></div>
            <div class="key-row"><span class="key-cap">Q</span> <span>AI Modu</span></div>
            <div class="key-row"><span class="key-cap">I</span> <span>Envanter</span></div>
            <div class="key-row"><span class="key-cap">M</span> <span>Harita</span></div>
            <div class="key-row"><span class="key-cap">ESC</span> <span>Menü</span></div>
        </div>
    </div>

    <!-- HUD -->
    <div class="hud-container">
        <div class="hud-icon-group">
            <div id="btn-inv-icon" class="hud-btn" title="Envanter (I)">
                ❖ <span id="inv-total-badge" class="hud-badge" style="display:none; position:absolute; top:-5px; right:-5px; background:#fff; color:#000; border-radius:50%; width:15px; height:15px; font-size:0.7rem; display:flex; justify-content:center; align-items:center;">0</span>
            </div>
            
            <div id="echo-wrapper-el" class="echo-wrapper">
                <div id="btn-echo-icon" class="hud-btn">
                    ◎ <span id="echo-total-badge" class="hud-badge" style="display:none; position:absolute; top:-5px; right:-5px; background:#67e8f9; color:#000; border-radius:50%; width:15px; height:15px; font-size:0.7rem; display:flex; justify-content:center; align-items:center;">0</span>
                </div>
                <div class="echo-dropdown">
                    <div class="echo-profile">
                        <div class="echo-p-icon">◈</div>
                        <div class="echo-p-stats">
                            <span class="echo-p-name">YANKI V1</span>
                            <span id="echo-rate-disp" class="echo-p-rate">Toplama Hızı: Normal</span>
                        </div>
                    </div>
                    <div id="menu-roam" class="echo-menu-item active-mode" onclick="setEchoMode('roam')">◈ SERBEST</div>
                    <div id="menu-return" class="echo-menu-item" onclick="setEchoMode('return')">↪ ÇAĞIR</div>
                    <div id="menu-merge" class="echo-menu-item" onclick="echoManualMerge()">☌ BİRLEŞ</div>
                    <div class="echo-menu-item" onclick="openEchoInventory()">❖ ENVANTER</div>
                </div>
            </div>
            
            <div class="ai-controls">
                <div id="btn-ai-toggle" class="hud-btn" title="Oto-Pilot (Q)">◈</div>
                <div id="ai-mode-btn" class="ai-mode-switch" onclick="cycleAIMode()">TOPLA</div>
            </div>
        </div>

        <div id="currency-display">
            <span style="color: rgba(255,255,255,0.6);">◆</span> <span id="stardust-amount">0</span>
        </div>
        
        <div id="xp-container">
            <div class="level-text">EVRİM SEVİYESİ <span id="level-val" class="text-white font-bold text-lg">1</span></div>
            <div class="xp-bar-bg"><div id="xp-fill" class="xp-bar-fill"></div></div>
        </div>

        <div id="btn-sound">♫</div>
        <div id="sound-panel">
            <div class="mb-4"><div class="flex justify-between text-xs text-gray-400 tracking-widest"><span>MÜZİK</span><span id="val-m">50%</span></div><input type="range" id="vol-music" min="0" max="100" value="50"></div>
            <div><div class="flex justify-between text-xs text-gray-400 tracking-widest"><span>ATMOSFER</span><span id="val-s">80%</span></div><input type="range" id="vol-sfx" min="0" max="100" value="80"></div>
        </div>

        <div id="notification-area"></div>
        <div id="merge-prompt"></div>

        <div id="speedometer">
            <span class="speed-label">HIZ</span>
            <div><span id="speed-val" class="speed-val">0</span><span class="speed-unit">KM/S</span></div>
        </div>

        <div id="minimap-wrapper">
            <div id="minimap-container"><canvas id="minimap-canvas"></canvas></div>
            <div id="energy-bar-container" title="Enerji">
                <div id="energy-bar-fill"></div>
            </div>
            <div class="coords" id="coords">0000 : 0000</div>
        </div>
    </div>

    <!-- BIG MAP OVERLAY -->
    <div id="big-map-overlay">
        <div class="big-map-container">
            <canvas id="big-map-canvas"></canvas>
            <div class="big-map-info-overlay">
                <h3 class="text-white font-light tracking-widest text-lg mb-4 border-b border-white/10 pb-2">LEJANT</h3>
                <div class="legend-item"><div class="l-dot" style="background:#fff; border:2px solid #38bdf8;"></div> SİZ</div>
                <div class="legend-item"><div class="l-dot" style="background:#fff; border:2px solid #fff;"></div> NEXUS</div>
                <div class="legend-item"><div class="l-dot" style="background:#67e8f9;"></div> YANKI</div>
                <div class="legend-item"><div class="l-dot" style="background:rgba(255,255,255,0.5);"></div> Kaynak</div>
                <div class="legend-item"><div class="l-dot" style="background:#84cc16;"></div> Zehirli Bölge</div>
                <div class="legend-item"><div class="l-dot" style="background:#C7C0AE;"></div> Tardigrad (+Enerji)</div>
                <div class="legend-item"><div class="l-dot" style="border:1px dashed #ef4444;"></div> Hedef</div>
            </div>
            <div class="map-tip">Oto-pilot ile gitmek için haritada bir noktaya tıklayın.</div>
            <div class="absolute top-4 right-4 cursor-pointer text-white opacity-50 hover:opacity-100" onclick="closeMap()">✕</div>
        </div>
    </div>

    <!-- ENVANTER (Tablo Görünümü) -->
    <div id="inventory-overlay" class="overlay-base">
        <div class="inv-window">
            <div style="display:flex; flex:1; overflow:hidden;">
                <div class="inv-sidebar">
                    <div class="text-xs text-gray-500 mb-4 tracking-widest">FİLTRELER</div>
                    <div class="filter-btn active" onclick="filterInventory('all')">Tümü <span id="count-all" class="text-xs opacity-50">0</span></div>
                    <div class="filter-btn" onclick="filterInventory('legendary')">Efsanevi <span id="count-legendary" class="text-xs opacity-50">0</span></div>
                    <div class="filter-btn" onclick="filterInventory('epic')">Destansı <span id="count-epic" class="text-xs opacity-50">0</span></div>
                    <div class="filter-btn" onclick="filterInventory('rare')">Nadir <span id="count-rare" class="text-xs opacity-50">0</span></div>
                </div>
                <div class="inv-content">
                    <div class="inv-header">
                        <h2 class="text-2xl font-light tracking-[0.2em] text-white">ENVANTER</h2>
                        <div class="cursor-pointer opacity-50 hover:opacity-100 text-xl" id="btn-close-inv">✕</div>
                    </div>
                    <div class="inv-table-container" id="inv-grid-content"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- YANKI ENVANTERI (Tablo Görünümü) -->
    <div id="echo-inventory-overlay" class="overlay-base">
        <div class="inv-window" style="border-color: var(--echo-color); height: 500px; width: 700px;">
            <div class="inv-content" style="background: rgba(0,0,0,0.3); padding: 20px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:20px; border-bottom:1px solid rgba(103, 232, 249, 0.3); padding-bottom:10px;">
                    <h2 class="text-2xl font-light tracking-widest text-cyan-300">YANKI DEPOSU</h2>
                    <div class="cursor-pointer text-xl opacity-50 hover:opacity-100" onclick="closeEchoInventory()">✕</div>
                </div>
                <div id="echo-inv-grid-content" style="overflow-y: auto; flex: 1;"></div>
            </div>
        </div>
    </div>

    <!-- NEXUS (BASE) EKRANI -->
    <div id="nexus-overlay" class="overlay-base">
        <div class="nexus-window">
            <div class="nexus-header">
                <div>
                    <h1 class="nexus-logo-text">NEXUS</h1>
                    <span class="text-xs text-gray-400 tracking-widest">TİCARET VE GELİŞTİRME İSTASYONU</span>
                </div>
                <div class="nexus-tabs">
                    <div class="nexus-tab active" onclick="switchNexusTab('market')">PAZAR</div>
                    <div class="nexus-tab" onclick="switchNexusTab('upgrades')">HANGAR</div>
                </div>
                <div class="cursor-pointer text-2xl opacity-50 hover:opacity-100" onclick="exitNexus()">✕</div>
            </div>
            <div id="tab-market" class="nexus-content active">
                <div class="flex justify-between items-center mb-6">
                    <p class="text-gray-400">Elde edilen materyalleri Yıldız Tozu karşılığında takas et.</p>
                    <button onclick="sellAll()" class="bg-white/10 text-white border border-white/20 px-6 py-2 rounded-sm hover:bg-white hover:text-black transition text-sm tracking-widest">TÜMÜNÜ SAT</button>
                </div>
                <div id="market-grid" class="market-grid"></div>
            </div>
            <div id="tab-upgrades" class="nexus-content">
                <div class="upgrade-grid">
                    <div><div class="upgrade-col-title text-sky-300">VOID RAY (SİZ)</div><div id="upg-player-list"></div></div>
                    <div><div class="upgrade-col-title text-cyan-300">ECHO RAY (YANKI)</div><div id="upg-echo-list"></div></div>
                </div>
            </div>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script src="js/data.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/entities.js"></script>
    <script src="js/game.js"></script>
</body>
</html>